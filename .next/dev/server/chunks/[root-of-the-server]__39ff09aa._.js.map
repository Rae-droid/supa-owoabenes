{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/OWOAHENE%20ACHEAMPONG/Documents/supa-owoabenes/lib/database/supabase.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\"\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\r\n\r\nif (!supabaseUrl || !supabaseAnonKey) {\r\n  console.error(\r\n    \"[v0] Supabase environment variables are missing! Check NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in your environment variables.\",\r\n  )\r\n}\r\n\r\n// Client for browser (use anon key)\r\nexport const supabaseBrowser = (() => {\r\n  if (!supabaseUrl || !supabaseAnonKey) {\r\n    console.warn(\"[v0] Supabase browser client unavailable - missing environment variables\")\r\n    return null\r\n  }\r\n  return createClient(supabaseUrl, supabaseAnonKey)\r\n})()\r\n\r\n// Server client (use service role key - only on server)\r\nexport const supabaseServer = (() => {\r\n  if (!supabaseUrl) {\r\n    console.error(\"[v0] Cannot create Supabase server client - NEXT_PUBLIC_SUPABASE_URL is missing\")\r\n    return null\r\n  }\r\n  const key = supabaseServiceKey || supabaseAnonKey\r\n  if (!key) {\r\n    console.error(\"[v0] Cannot create Supabase server client - no valid API key available\")\r\n    return null\r\n  }\r\n  return createClient(supabaseUrl, key)\r\n})()\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,wBAAwB;AACxD,MAAM,kBAAkB,QAAQ,GAAG,CAAC,6BAA6B;AACjE,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;AAEhE,IAAI,CAAC,eAAe,CAAC,iBAAiB;IACpC,QAAQ,KAAK,CACX;AAEJ;AAGO,MAAM,kBAAkB,CAAC;IAC9B,IAAI,CAAC,eAAe,CAAC,iBAAiB;QACpC,QAAQ,IAAI,CAAC;QACb,OAAO;IACT;IACA,OAAO,IAAA,yMAAY,EAAC,aAAa;AACnC,CAAC;AAGM,MAAM,iBAAiB,CAAC;IAC7B,IAAI,CAAC,aAAa;QAChB,QAAQ,KAAK,CAAC;QACd,OAAO;IACT;IACA,MAAM,MAAM,sBAAsB;IAClC,IAAI,CAAC,KAAK;QACR,QAAQ,KAAK,CAAC;QACd,OAAO;IACT;IACA,OAAO,IAAA,yMAAY,EAAC,aAAa;AACnC,CAAC","debugId":null}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/OWOAHENE%20ACHEAMPONG/Documents/supa-owoabenes/app/api/transactions/route.ts"],"sourcesContent":["import { supabaseServer } from \"@/lib/database/supabase\"\r\nimport { type NextRequest, NextResponse } from \"next/server\"\r\n\r\nexport async function GET() {\r\n  try {\r\n    if (!supabaseServer) {\r\n      return NextResponse.json(\r\n        { success: false, error: \"Database client not initialized. Check environment variables.\" },\r\n        { status: 500 },\r\n      )\r\n    }\r\n\r\n    const { data, error } = await supabaseServer\r\n      .from(\"transactions\")\r\n      .select(\"*\")\r\n      .order(\"created_at\", { ascending: false })\r\n\r\n    if (error) throw error\r\n\r\n    return NextResponse.json({ success: true, data })\r\n  } catch (error: any) {\r\n    console.error(\"[v0] Error fetching transactions:\", error.message)\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    if (!supabaseServer) {\r\n      return NextResponse.json(\r\n        { success: false, error: \"Database client not initialized. Check environment variables.\" },\r\n        { status: 500 },\r\n      )\r\n    }\r\n\r\n    const transactionData = await request.json()\r\n\r\n    if (transactionData.items && Array.isArray(transactionData.items)) {\r\n      for (const item of transactionData.items) {\r\n        if (item.id && item.quantity) {\r\n          // Get current quantity\r\n          const { data: productData, error: fetchError } = await supabaseServer\r\n            .from(\"products\")\r\n            .select(\"quantity\")\r\n            .eq(\"id\", item.id)\r\n            .single()\r\n\r\n          if (fetchError) {\r\n            console.error(`[v0] Error fetching product ${item.id}:`, fetchError.message)\r\n            continue\r\n          }\r\n\r\n          const currentQuantity = productData?.quantity || 0\r\n          const newQuantity = Math.max(0, currentQuantity - item.quantity)\r\n\r\n          const { error: updateErr } = await supabaseServer\r\n            .from(\"products\")\r\n            .update({ quantity: newQuantity })\r\n            .eq(\"id\", item.id)\r\n\r\n          if (updateErr) {\r\n            console.error(`[v0] Error updating quantity for product ${item.id}:`, updateErr.message)\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Insert the transaction record\r\n    const { data, error } = await supabaseServer.from(\"transactions\").insert([transactionData]).select()\r\n\r\n    if (error) throw error\r\n\r\n    return NextResponse.json({ success: true, data: data[0] }, { status: 201 })\r\n  } catch (error: any) {\r\n    console.error(\"[v0] Error adding transaction:\", error.message)\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,IAAI,CAAC,+IAAc,EAAE;YACnB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAgE,GACzF;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,+IAAc,CACzC,IAAI,CAAC,gBACL,MAAM,CAAC,KACP,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,IAAI,OAAO,MAAM;QAEjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAK;IACjD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,qCAAqC,MAAM,OAAO;QAChE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,IAAI,CAAC,+IAAc,EAAE;YACnB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAgE,GACzF;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,kBAAkB,MAAM,QAAQ,IAAI;QAE1C,IAAI,gBAAgB,KAAK,IAAI,MAAM,OAAO,CAAC,gBAAgB,KAAK,GAAG;YACjE,KAAK,MAAM,QAAQ,gBAAgB,KAAK,CAAE;gBACxC,IAAI,KAAK,EAAE,IAAI,KAAK,QAAQ,EAAE;oBAC5B,uBAAuB;oBACvB,MAAM,EAAE,MAAM,WAAW,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,+IAAc,CAClE,IAAI,CAAC,YACL,MAAM,CAAC,YACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;oBAET,IAAI,YAAY;wBACd,QAAQ,KAAK,CAAC,CAAC,4BAA4B,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,EAAE,WAAW,OAAO;wBAC3E;oBACF;oBAEA,MAAM,kBAAkB,aAAa,YAAY;oBACjD,MAAM,cAAc,KAAK,GAAG,CAAC,GAAG,kBAAkB,KAAK,QAAQ;oBAE/D,MAAM,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,+IAAc,CAC9C,IAAI,CAAC,YACL,MAAM,CAAC;wBAAE,UAAU;oBAAY,GAC/B,EAAE,CAAC,MAAM,KAAK,EAAE;oBAEnB,IAAI,WAAW;wBACb,QAAQ,KAAK,CAAC,CAAC,yCAAyC,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,EAAE,UAAU,OAAO;oBACzF;gBACF;YACF;QACF;QAEA,gCAAgC;QAChC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,+IAAc,CAAC,IAAI,CAAC,gBAAgB,MAAM,CAAC;YAAC;SAAgB,EAAE,MAAM;QAElG,IAAI,OAAO,MAAM;QAEjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM,IAAI,CAAC,EAAE;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC3E,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,kCAAkC,MAAM,OAAO;QAC7D,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF","debugId":null}}]
}